<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sá»• Thu Chi</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="static/css/style.css" />
    <link rel="icon" type="image/png" href="static/images/favicon.png" />
  </head>
  <body>
    <div id="fallingIconsContainer" aria-hidden="true">
      <span>ğŸ’°</span> <span>ğŸ’¸</span> <span>âœ¨</span> <span>ğŸ‰</span>
      <span>ğŸª™</span> <span>ğŸ“ˆ</span> <span>ğŸ’³</span> <span>ğŸ§¾</span>
      <span>ğŸ’¯</span> <span>ğŸ¦</span> <span>ğŸ</span> <span>ğŸ›ï¸</span>
    </div>
    <div class="container">
      <div class="header">
        <h1>ğŸ’°Sá»• Thu ChiğŸ’°</h1>
        <p>Quáº£n lÃ½ tÃ i chÃ­nh cÃ¡ nhÃ¢n vá»›i Supabase</p>
      </div>

      <div id="statusMessage" class="status loading">
        <span class="loading-spinner"></span> Äang khá»Ÿi táº¡o á»©ng dá»¥ng...
      </div>

      <div id="setupSection" class="setup-section hidden">
        <h2>Cáº¥u hÃ¬nh Supabase & Sá»‘ dÆ° ban Ä‘áº§u</h2>
        <p>
          Nháº­p thÃ´ng tin Supabase vÃ  sá»‘ dÆ° ban Ä‘áº§u cá»§a báº¡n (chá»‰ cáº§n lÃ m láº§n
          Ä‘áº§u):
        </p>
        <div class="setup-form">
          <div class="form-group">
            <label for="supabaseUrl">Supabase URL:</label>
            <input
              type="text"
              id="supabaseUrl"
              placeholder="https://your-project-ref.supabase.co"
            />
          </div>
          <div class="form-group">
            <label for="supabaseKey">Supabase Anon Key:</label>
            <input
              type="text"
              id="supabaseKey"
              placeholder="Supabase Anon Key (public)"
            />
          </div>
          <div class="form-group">
            <label for="initialBalance">Sá»‘ dÆ° ban Ä‘áº§u (VNÄ):</label>
            <input
              type="number"
              id="initialBalance"
              placeholder="0"
              value="0"
              step="1000"
            />
          </div>
          <button class="btn" id="connectSupabaseBtn">LÆ°u & Káº¿t ná»‘i</button>
        </div>
        <div class="setup-guide">
          <h4>HÆ°á»›ng dáº«n setup Supabase:</h4>
          <ol>
            <li>
              Táº¡o tÃ i khoáº£n táº¡i
              <a href="https://supabase.com" target="_blank">supabase.com</a>
            </li>
            <li>Táº¡o project má»›i.</li>
            <li>VÃ o Project Settings â†’ API Ä‘á»ƒ láº¥y URL vÃ  anon key.</li>
            <li>Trong Supabase Studio, vÃ o SQL Editor, cháº¡y SQL sau:</li>
          </ol>
          <pre>
-- XÃ³a báº£ng cÅ© náº¿u tá»“n táº¡i Ä‘á»ƒ trÃ¡nh lá»—i khi cháº¡y láº¡i script
DROP TABLE IF EXISTS transactions;

CREATE TABLE transactions (
  id BIGSERIAL PRIMARY KEY,
  description TEXT NOT NULL,
  amount DECIMAL(15,2) NOT NULL,
  type VARCHAR(10) NOT NULL CHECK (type IN ('income', 'expense')),
  category VARCHAR(50),
  notes TEXT,
  transaction_datetime TIMESTAMP WITH TIME ZONE NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

ALTER TABLE transactions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Allow all operations for demo" ON transactions
  FOR ALL
  USING (true)
  WITH CHECK (true);
                </pre
          >
          <p class="note-important">
            LÆ°u Ã½: SQL trÃªn lÃ  vÃ­ dá»¥. Äá»‘i vá»›i á»©ng dá»¥ng thá»±c táº¿, báº¡n cáº§n thiáº¿t
            láº­p Row Level Security (RLS) cháº·t cháº½ hÆ¡n.
          </p>
        </div>
      </div>

      <div id="mainApp" class="hidden">
        <div class="balance">
          <div class="balance-item">
            <h3>ğŸ’š Thu nháº­p</h3>
            <div class="balance-amount income" id="totalIncome">0â‚«</div>
          </div>
          <div class="balance-item">
            <h3>ğŸ’¸ Chi tiÃªu</h3>
            <div class="balance-amount expense" id="totalExpense">0â‚«</div>
          </div>
          <div class="balance-item">
            <h3>ğŸ’ Sá»‘ dÆ° (+ Ban Ä‘áº§u)</h3>
            <div class="balance-amount total" id="totalBalance">0â‚«</div>
          </div>
        </div>

        <div class="form-section">
          <h2>â• ThÃªm giao dá»‹ch má»›i</h2>
          <form id="transactionForm">
            <div class="form-grid">
              <div class="form-group">
                <label for="description">ğŸ“ MÃ´ táº£:</label>
                <input
                  type="text"
                  id="description"
                  required
                  placeholder="VÃ­ dá»¥: Mua cÃ  phÃª sÃ¡ng"
                />
              </div>
              <div class="form-group">
                <label for="amount">ğŸ’µ Sá»‘ tiá»n:</label>
                <input
                  type="number"
                  id="amount"
                  required
                  step="1000"
                  placeholder="100000"
                />
              </div>
              <div class="form-group">
                <label for="type">ğŸ“Š Loáº¡i:</label>
                <select id="type" required>
                  <option value="expense">ğŸ’¸ Chi tiÃªu</option>
                  <option value="income">ğŸ’° Thu nháº­p</option>
                </select>
              </div>
              <div class="form-group">
                <label for="category">ğŸ·ï¸ Danh má»¥c:</label>
                <select id="category" required></select>
              </div>
              <div class="form-group">
                <label for="transaction_datetime">
                  <span class="label-icon">ğŸ“…</span>
                  <span class="label-text">NgÃ y & Giá»:</span>
                </label>
                <input
                  type="datetime-local"
                  id="transaction_datetime"
                  name="transaction_datetime"
                />
              </div>
              <div class="form-group">
                <label for="notes">ğŸ“„ Ghi chÃº (tÃ¹y chá»n):</label>
                <textarea
                  id="notes"
                  rows="2"
                  placeholder="ThÃªm ghi chÃº..."
                ></textarea>
              </div>
            </div>
            <button type="submit" class="btn" id="submitBtn">
              â• ThÃªm giao dá»‹ch
            </button>
          </form>
        </div>

        <div class="stats-section">
          <h2>ğŸ“Š Thá»‘ng kÃª</h2>
          <div class="form-group filter-group">
            <label for="filterPeriod">ğŸ“… Xem theo:</label>
            <select id="filterPeriod">
              <option value="month">ThÃ¡ng nÃ y</option>
              <option value="last30days">30 ngÃ y qua</option>
              <option value="year">NÄƒm nay</option>
              <option value="all">ToÃ n bá»™</option>
            </select>
          </div>
          <div id="statsLoading" class="loading-indicator hidden">
            Äang tÃ­nh toÃ¡n...
          </div>
          <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
              <div class="stat-number" id="totalTransactions">0</div>
              <div class="stat-label">Tá»•ng giao dá»‹ch (Ä‘Ã£ lá»c)</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="avgExpense">0â‚«</div>
              <div class="stat-label">Chi tiÃªu TB/ngÃ y (Ä‘Ã£ lá»c)</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="periodIncome">0â‚«</div>
              <div class="stat-label">Thu nháº­p (Ä‘Ã£ lá»c)</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="periodExpense">0â‚«</div>
              <div class="stat-label">Chi tiÃªu (Ä‘Ã£ lá»c)</div>
            </div>
          </div>
          <div class="chart-container">
            <h3>Biá»ƒu Ä‘á»“ Thu vs Chi (12 thÃ¡ng gáº§n nháº¥t)</h3>
            <canvas id="monthlyChart"></canvas>
          </div>
        </div>

        <div class="transactions">
          <h2>ğŸ“‹ Lá»‹ch sá»­ giao dá»‹ch</h2>
          <div id="transactionsList">
            <div class="empty-state" id="transactionsEmptyState">
              <div class="loading-spinner"></div>
              <h3>Äang táº£i dá»¯ liá»‡u...</h3>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-section" style="text-align: center; padding: 20px 0; border-top: 1px solid var(--border-color); margin-top: 2rem;">
        <p class="text-muted mb-0" style="color: var(--text-muted); font-size: 0.9rem;">
          Â©
          <script>
            document.write(new Date().getFullYear());
          </script>
          Sá»• Thu Chi
          <span class="footer-right-content" style="display: inline-block; margin-left: 10px;">
            ÄÆ°á»£c thiáº¿t káº¿ vÃ  váº­n hÃ nh bá»Ÿi
            <span style="color: var(--expense-color); display: inline-block; margin: 0 2px; font-size: 1.1em;">&hearts;</span> VÅ© Pháº¡m Viá»‡t HÃ¹ng
          </span>
        </p>
      </div>
      </div> <script src="static/js/script.js"></script>
  </body>
</html>